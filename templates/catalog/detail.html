{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Haron Market{% endblock %}

{% block content %}
        <div class="container">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="{% url 'core:index' %}">Главная</a></li>
              <li class="breadcrumb-item"><a href="{% url 'catalog:catalog' %}">Каталог</a></li>
              {% if product.category %}
                <li class="breadcrumb-item"><a href="{% url 'catalog:catalog' %}">{{ product.category.name }}</a></li>
              {% endif %}
              <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
            </ol>
          </nav>
          <div class="title-3 d-lg-none mb-3">{{ product.name }}</div>
          <div class="row"> 
            <div class="col-lg-6 col-md-6 col-12 mb-3 mb-md-0">
              <div class="gallery">
                <div class="gallery__slider">
                  {% if product.images_list %}
                    {% for image in product.images_list %}
                      <div class="gallery__slide gallery__slide--photo">
                        <div class="gallery__slide-center"><img src="{{ image.image.url }}" alt="{{ image.alt_text|default:product.name }}"></div>
                      </div>
                    {% endfor %}
                  {% else %}
                    <div class="gallery__slide gallery__slide--photo">
                      <div class="gallery__slide-center"><img src="{% static 'img/item.svg' %}" alt="{{ product.name }}"></div>
                    </div>
                  {% endif %}
                </div>
                {% if product.images_list|length > 1 %}
                  <div class="gallery__footer">
                    <div class="gallery__prev _disabled">
                      <svg>
                        <use xlink:href="#arrow"></use>
                      </svg>
                    </div>
                    <div class="gallery__next">
                      <svg>
                        <use xlink:href="#arrow"></use>
                      </svg>
                    </div>
                    <div class="gallery__footer-scroller">
                      {% for image in product.images_list %}
                        <div class="gallery__thumb"><img src="{{ image.image.url }}" alt="{{ image.alt_text|default:product.name }}"></div>
                      {% endfor %}
                    </div>
                  </div>
                {% endif %}
              </div>
            </div>
            <div class="col-lg-6 col-md-6 col-12">
              <div class="title-3 d-none d-lg-block">{{ product.name }}</div>
              <div class="detail-prices">
                {% if product.discount_price %}
                  <div class="_old">{{ product.price|floatformat:2 }} руб.</div>
                  <div class="_new">{{ product.discount_price|floatformat:2 }} руб.</div>
                {% else %}
                  {{ product.price|floatformat:2 }} руб.
                {% endif %}
              </div>
              {% if product.description %}
                <div class="mt-3">
                  <div class="title-3">Описание:</div>
                  <div class="product-description">{{ product.description|safe }}</div>
                </div>
              {% endif %}
              {% if product.color %}
                <div class="title-3 mt-2">Цвет:</div>
                <select class="mt-05 chosen" name="color" data-placeholder="Пожалуйста, выберите">
                  <option></option>
                  <option value="{{ product.color }}" selected>{{ product.get_color_display }}</option>
                </select>
              {% endif %}
              {% if product.shape %}
                <div class="title-3 mt-2">Форма:</div>
                <select class="mt-05 chosen" name="shape" data-placeholder="Пожалуйста, выберите">
                  <option></option>
                  <option value="{{ product.shape }}" selected>{{ product.get_shape_display }}</option>
                </select>
              {% endif %}
              <div class="title-3 mt-2">Количество:</div>
              <div class="quantity mt-05">
                <input class="form-control" type="number" min="1" step="1" value="1" id="quantity-input">
              </div>
              <div class="detail-actions mt-2"> 
                <button class="btn btn-primary" onclick="addToCart({{ product.id }})">Добавить в корзину</button>
                <button class="favorite ms-05"></button>
              </div>
            </div>
          </div>
          {% if related_products %}
            <div class="mt-5">
              <div class="title-2">Похожие товары</div>
              <div class="row row-cols-xl-4 row-cols-md-3 row-cols-2">
                {% for related_product in related_products %}
                  <div class="col">
                    <div class="card-product">
                      <div class="card-product__img">
                        <div>
                          {% if related_product.images.all %}
                            {% with main_image=related_product.images.all|first %}
                              <img src="{{ main_image.image.url }}" alt="{{ main_image.alt_text|default:related_product.name }}"/>
                            {% endwith %}
                          {% else %}
                            <img src="{% static 'img/item.svg' %}" alt="{{ related_product.name }}"/>
                          {% endif %}
                        </div>
                      </div>
                      <a class="card-product__title" href="{% url 'catalog:detail' product_id=related_product.id %}">{{ related_product.name }}</a>
                      <div class="card-product__price">
                        {% if related_product.discount_price %}
                          <nobr class="_old">{{ related_product.price|floatformat:2 }} руб.</nobr>
                          <nobr>от {{ related_product.discount_price|floatformat:2 }} руб.</nobr>
                        {% else %}
                          от {{ related_product.price|floatformat:2 }} руб.
                        {% endif %}
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
          <script>
            function addToCart(productId) {
              var quantity = document.getElementById('quantity-input').value;
              // TODO: Реализовать добавление в корзину
              alert('Товар добавлен в корзину (функция в разработке)');
            }
          </script>
        </div>
{% endblock %}

{% block modals %}
    <div class="modal fade" tabindex="-1" aria-labelledby="choose-city" aria-hidden="true" id="choose-city">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body">
            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="title-3 mb-2">Выберите город</div>
            <select class="chosen" name="" data-placeholder="Ваш город">
              <option></option>
              <option>Красноярск</option>
              <option>Тюмень</option>
              <option>Красноярск</option>
              <option>Томск</option>
              <option>Красноярск</option>
              <option>Уфа</option>
              <option>Красноярск</option>
              <option>Тюмень</option>
              <option>Красноярск</option>
              <option>Томск</option>
              <option>Красноярск</option>
              <option>Уфа</option>
              <option>Красноярск</option>
              <option>Тюмень</option>
              <option>Красноярск</option>
              <option>Томск</option>
              <option>Красноярск</option>
              <option>Уфа</option>
            </select>
            <button class="btn btn-primary w-100 mt-2">Перейти</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" tabindex="-1" aria-labelledby="order-partner" aria-hidden="true" id="order-partner">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <form class="modal-body">
            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="title-3 mb-2">Заполните анкету на партнерство!</div>
            <div class="row row-col-md-2">
              <div class="col">
                <label class="mb-1">
                  <p class="form-label">Фамилия</p>
                  <input class="form-control" type="text" placeholder="Фамилия" required>
                </label>
                <label class="mb-1">
                  <p class="form-label">Имя</p>
                  <input class="form-control" type="text" placeholder="Имя" required>
                </label>
                <label class="mb-1">
                  <p class="form-label">Отчество</p>
                  <input class="form-control" type="text" placeholder="Отчество" required>
                </label>
                <label class="mb-1">
                  <p class="form-label">Город</p>
                  <input class="form-control" type="text" placeholder="Город" required>
                </label>
                <label class="mb-1">
                  <p class="form-label">Позиция товара</p>
                  <input class="form-control" type="text" placeholder="Позиция товара" required>
                </label>
              </div>
              <div class="col">
                <label class="mb-1">
                  <p class="form-label">ИП или ООО</p>
                  <input class="form-control" type="text" placeholder="ИП или ООО" required>
                </label>
                <label class="mb-1">
                  <p class="form-label">Паспортные данные</p>
                  <textarea class="form-control" type="text" placeholder="Паспортные данные" required></textarea>
                </label>
              </div>
            </div>
            <p class="text-muted mb-1">Отправляя данные вы соглашаетесь с <a href="">политикой конфиденциальности </a></p>
            <button class="btn btn-primary">Отправить</button>
          </form>
        </div>
      </div>
    </div>
    <div class="modal fade" tabindex="-1" aria-labelledby="pay-success" aria-hidden="true" id="pay-success">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <form class="modal-body p-md-3">
            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="title-3 mb-2">Оплата прошла успешно!</div>
            <p>Вся информация о заказе отправлена вам на почту. В ближайшее время с вами свяжется поставщик.</p>
            <p>Если будут вопросы - звоните нам!</p><a class="fs-5" href="tel: 8 800 800 80 00"><img class="me-1" src="{% static 'img/phone.svg' %}" alt="">8 800 800 80 00</a>
          </form>
        </div>
      </div>
    </div>
    <div class="modal fade" tabindex="-1" aria-labelledby="account-settings" aria-hidden="true" id="account-settings">
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-body">
            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="title-2 mt-0 mb-2">Настройки</div>
            <ul class="nav nav-tabs">
              <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#account-settings-tab-1" type="button" role="tab">Основная информация</button>
              </li>
              <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#account-settings-tab-2" type="button" role="tab">Информация о компании</button>
              </li>
              <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#account-settings-tab-3" type="button" role="tab">Безопасность</button>
              </li>
              <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#account-settings-tab-4" type="button" role="tab">Подписка и аккаунт</button>
              </li>
            </ul>
            <div class="tab-content py-2">
              <div class="tab-pane fade active show" role="tabpanel" id="account-settings-tab-1">
                <form>
                  <div class="row row-cols-lg-3 row-cols-md-2 row-cols-1">
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">Фамилия*</p>
                        <input class="form-control" type="text" value="" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">Имя *</p>
                        <input class="form-control" type="text" value="Евгения" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">Отчество *</p>
                        <input class="form-control" type="text" value="Сергеевна" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">Номер телефона *</p>
                        <input class="form-control" type="tel" value="+7 (908) 667-78-76" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">E-mail*</p>
                        <input class="form-control" type="email" value="pochta@gmail.com" required>
                      </label>
                    </div>
                  </div>
                  <div class="mt-2">
                    <button class="btn btn-outline-primary">Сохранить</button>
                  </div>
                </form>
              </div>
              <div class="tab-pane fade" role="tabpanel" id="account-settings-tab-2">
                <form>
                  <div class="row row-cols-lg-3 row-cols-md-2 row-cols-1">
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">Название компании*</p>
                        <input class="form-control" type="text" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">ИНН *</p>
                        <input class="form-control" type="text" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">Город *</p>
                        <input class="form-control" type="text" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">Рабочий телефон *</p>
                        <input class="form-control" type="tel" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">E-mail*</p>
                        <input class="form-control" type="email" required>
                      </label>
                    </div>
                    <div class="col">
                      <label class="mb-1">
                        <p class="form-label form-label--small">Р/С *</p>
                        <input class="form-control" type="text" required>
                      </label>
                    </div>
                  </div>
                  <div class="mt-2">
                    <button class="btn btn-outline-primary">Сохранить</button>
                  </div>
                </form>
              </div>
              <div class="tab-pane fade" role="tabpanel" id="account-settings-tab-3">
                <form class="needs-validation" novalidate>
                  <label class="mb-1">
                    <p class="form-label form-label--small">Старый пароль *</p>
                    <input class="form-control" type="password" required>
                    <div class="invalid-feedback">Неверно введен пароль</div>
                  </label>
                  <label class="mb-1">
                    <p class="form-label form-label--small">Новый пароль *</p>
                    <input class="form-control" type="password" required>
                  </label>
                  <label class="mb-1">
                    <p class="form-label form-label--small">Повтор пароля *</p>
                    <input class="form-control" type="password" required>
                    <div class="invalid-feedback">Пароли не совпадают</div>
                  </label>
                  <div class="mt-2">
                    <button class="btn btn-outline-primary">Сохранить</button>
                  </div>
                </form>
              </div>
              <div class="tab-pane fade" role="tabpanel" id="account-settings-tab-4">
                <div class="alert alert-primary alert-dismissible fade show" role="alert">
                  <div class="text-center">Ваш тарифный план: Мегаплан. Тариф оплачен до: 27.02.2021. </div>
                  <button class="btn-close" type="button" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                  <div class="text-center">Ваш тариф закончился. Для продолжения выберите и оплатите тариф из списка.</div>
                </div>
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                  <div class="row align-items-center">
                    <div class="col">
                      <div class="text-center">Ваша подписка скоро закончится. Тариф оплачен до: 27.02.2021.</div>
                    </div>
                    <div class="col-auto"><a class="btn btn-danger btn-sm" href="">Оплатить</a></div>
                  </div>
                </div>
                <div class="row justify-content-end my-2">
                  <div class="col-auto">
                    <div class="form-check form-switch">
                      <input class="form-check-input" id="flexSwitchCheckChecked38049756" type="checkbox" checked>
                      <label class="form-check-label" for="flexSwitchCheckChecked38049756">Автопродление</label>
                    </div>
                  </div>
                </div>
                <div class="title-3 mb-2">Тарифы</div>
                <div class="card-line"> 
                  <div class="card-line__row align-items-center">
                    <div class="card-line__col">1 месяц <strong>Мегаплан</strong></div>
                    <div class="card-line__col-auto">800 руб</div>
                    <div class="card-line__col-auto"><a class="btn btn-success btn-sm" href="">Оплатить </a></div>
                  </div>
                </div>
                <div class="card-line"> 
                  <div class="card-line__row align-items-center">
                    <div class="card-line__col">1 месяц <strong>Мегаплан</strong></div>
                    <div class="card-line__col-auto">800 руб</div>
                    <div class="card-line__col-auto"><a class="btn btn-success btn-sm" href="">Оплатить </a></div>
                  </div>
                </div>
                <div class="card-line"> 
                  <div class="card-line__row align-items-center">
                    <div class="card-line__col">1 месяц <strong>Мегаплан</strong></div>
                    <div class="card-line__col-auto">800 руб</div>
                    <div class="card-line__col-auto"><a class="btn btn-success btn-sm" href="">Оплатить </a></div>
                  </div>
                </div>
                <div class="card-line bg-primary">
                  <div class="card-line__row align-items-center">
                    <div class="card-line__col text-white">1 месяц <strong>Мегаплан</strong></div>
                    <div class="card-line__col-auto text-white">800 руб</div>
                    <div class="card-line__col-auto"><a class="btn btn-success btn-sm" href="">Оплатить </a></div>
                  </div>
                </div>
                <div class="card-line bg-success">
                  <div class="card-line__row align-items-center">
                    <div class="card-line__col text-white">1 месяц <strong>Мегаплан</strong></div>
                    <div class="card-line__col-auto text-white">800 руб</div>
                    <div class="card-line__col-auto"><a class="btn btn-primary btn-sm" href="">Оплатить </a></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endblock %}
